{% extends 'admin_site/layout.html' %}
{% block 'main' %}

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        Class Roster: {{ student_class.name|upper }} {{ class_section.name|upper }}
                    </h5>
                    <div>
                        <a href="{% url 'class_detail' student_class.id %}" class="btn btn-secondary btn-sm" title="Back to Class Detail">
                            <i class="bi bi-arrow-left"></i> Back to Class
                        </a>
                        <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#assignTeacherModal">
                            <i class="bi bi-person-plus"></i>
                            {% if class_section_info.form_teacher %}
                                Update Form Teacher
                            {% else %}
                                Assign Form Teacher
                            {% endif %}
                        </button>
                    </div>
                </div>

                {% include 'admin_site/partials/messages.html' %}

                <div class="row mt-3">
                    <!-- Class Card -->
                    <div class="col-md-6 col-lg-3">
                        <div class="card info-card sales-card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">Class</h5>
                                <div class="d-flex align-items-center">
                                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                        <i class="bi bi-building"></i>
                                    </div>
                                    <div class="ps-3"><h6>{{ student_class.name|upper }}</h6></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Section Card -->
                    <div class="col-md-6 col-lg-3">
                        <div class="card info-card revenue-card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">Section</h5>
                                <div class="d-flex align-items-center">
                                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                        <i class="bi bi-diagram-3"></i>
                                    </div>
                                    <div class="ps-3"><h6>{{ class_section.name|upper }}</h6></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Student Count Card -->
                    <div class="col-md-6 col-lg-3">
                        <div class="card info-card customers-card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">Students</h5>
                                <div class="d-flex align-items-center">
                                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                        <i class="bi bi-people"></i>
                                    </div>
                                    <div class="ps-3"><h6>{{ class_section_info.number_of_students|default:"0" }}</h6></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Form Teacher Card -->
                    <div class="col-md-6 col-lg-3">
                        <div class="card info-card-form-teacher shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">Form Teacher</h5>
                                <div class="d-flex align-items-center">
                                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                        <i class="bi bi-person-video3"></i>
                                    </div>
                                    <div class="ps-3">
                                        <h6>{{ class_section_info.form_teacher.full_name|default:"Not Assigned" }}</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Assign/Update Teacher Modal -->
<div class="modal fade" id="assignTeacherModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form method="POST" action="{% url 'class_section_info_edit' pk=class_section_info.pk|default:0 %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title"><b>Assign Teacher to {{ student_class.name|upper }} {{ class_section.name|upper }}</b></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- These hidden fields are essential for the form to know which class/section to update -->
                    <input type="hidden" name="student_class" value="{{ student_class.id }}">
                    <input type="hidden" name="section" value="{{ class_section.id }}">

                    <label for="id_form_teacher" class="form-label">Select Form Teacher</label>
                    {% if teacher_list %}
                        <select name="form_teacher" class="form-select" id="id_form_teacher">
                            <option value="">--------- UN-ASSIGN TEACHER ---------</option>
                            {% for teacher in teacher_list %}
                                <option value="{{ teacher.id }}" {% if teacher == class_section_info.form_teacher %}selected{% endif %}>
                                    {{ teacher.full_name|upper }}
                                </option>
                            {% endfor %}
                        </select>
                    {% else %}
                        <div class="alert alert-warning">
                            No teachers have been registered in the system yet. Please add teachers first.
                        </div>
                    {% endif %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" {% if not teacher_list %}disabled{% endif %}>Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}
